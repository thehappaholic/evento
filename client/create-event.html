<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Create Event | Evento</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* Reset + Base */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'League Spartan', sans-serif;
      background:#ffff;
      color: #222;
    }
    .container {
      max-width: 900px;
      margin: 2rem auto;
      padding: 1rem;
    }
    h2.section-title {
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 1.2rem;
      color: #149631;
    }
    .step-box {
      background: #e1f8cd;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      margin-bottom: 2rem;
    }

    /* Step management */
    .step { display: none; }
    .step.active { display: block; }

    /* Tier cards */
    .event-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }
    .tier-card {
      background: #fdfdfd;
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 1rem;
      text-align: center;
      transition: 0.2s ease;
    }
    .tier-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 3px 8px rgba(0,0,0,0.08);
    }
    .tier-card h3 {
      margin-bottom: 0.5rem;
      color:#149631;
    }

    /* Form grid */
    .step-box-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }
    .form-group {
      display: flex;
      flex-direction: column;
    }
    .form-group label {
      font-weight: 600;
      margin-bottom: 0.3rem;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 0.6rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 0.95rem;
    }
    textarea { resize: vertical; }

    /* Buttons */
    .btn {
      padding: 0.6rem 1.2rem;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s ease;
      border: none;
    }
    .btn:hover { opacity: 0.9; }
    .btn-outline {
      border: 1px solid #fff;
      background: #149631;
      color: #fff;
    }
    .btn-outline:hover { background: #fff; color: #fff; }
    .login-submit {
      background: #fff;
      color: #fff;
    }

    /* Policy agreement */
    .policy-agreement {
      background: #f9f9f9;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .step-box-grid {
        grid-template-columns: 1fr;
      }
      .step-box {
        padding: 1rem;
      }
      h2.section-title {
        font-size: 1.3rem;
      }
      .btn, .btn-outline {
        flex: 1;
        margin: 0.3rem;
      }
      .form-group input,
      .form-group select,
      .form-group textarea {
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- STEP 1: Select Tier -->
    <div class="step active" id="step1">
      <div class="step-box">
        <h2 class="section-title">Choose Event Tier</h2>
        <div class="event-grid">
          <div class="tier-card">
            <h3>üé® Creator</h3>
            <p>In-person events for limited participants.</p>
            <button class="btn btn-outline" onclick="setTier('creator')">Select</button>
          </div>
          <div class="tier-card">
            <h3>üíª Virtual Host</h3>
            <p>Online events for the public.</p>
            <button class="btn btn-outline" onclick="setTier('virtual')">Select</button>
          </div>
          <div class="tier-card">
            <h3>üå± Community Host</h3>
            <p>Offline NGO/community events.<br><strong>Host login required</strong></p>
            <button class="btn btn-outline" onclick="requireHost('community')">Select</button>
          </div>
          <div class="tier-card">
            <h3>üè¢ Enterprise Host</h3>
            <p>Recurring business/club events.<br><strong>Host login required</strong></p>
            <button class="btn btn-outline" onclick="requireHost('enterprise')">Select</button>
          </div>
        </div>
      </div>
    </div>

    <!-- STEP 2: Event Details -->
    <div class="step" id="step2">
      <div class="step-box step-box-grid">
        <h2 class="section-title" style="grid-column: span 2;">Event Details</h2>
        <div class="form-group"><label>Title</label><input type="text" id="title" /></div>
        <div class="form-group" style="grid-column: span 2;"><label>Description</label><textarea id="description" rows="3"></textarea></div>
        <div class="form-group"><label>Type</label>
          <select id="type"><option>Workshop</option><option>Webinar</option><option>Meetup</option></select>
        </div>
        <div class="form-group"><label>Date</label><input type="date" id="date" /></div>
        <div class="form-group"><label>Time</label><input type="time" id="time" /></div>
        <div class="form-group"><label id="label-venue">Venue</label><input type="text" id="venueOrUrl" /></div>
        <div class="form-group"><label>Location</label><input type="text" id="location" /></div>
        <div class="form-group"><label>Duration (hrs)</label><input type="number" id="duration" /></div>
        <div class="form-group"><label>Max Participants</label><input type="number" id="maxParticipants" /></div>
        <div class="form-group" style="grid-column: span 2;">
          <label>Mode</label>
          <label><input type="radio" name="mode" value="free" checked /> Free</label>
          <label><input type="radio" name="mode" value="paid" /> Paid</label>
          <label><input type="radio" name="mode" value="rsvp" /> RSVP</label>
        </div>
        <div class="form-group" id="ticketPriceGroup" style="grid-column: span 2;">
          <label>Ticket Price</label><input type="number" id="ticketPrice" />
        </div>
        <div style="grid-column: span 2; display: flex; justify-content: space-between; flex-wrap: wrap;">
          <button class="btn btn-outline" onclick="goToStep(1)">Back</button>
          <button class="btn login-submit" onclick="goToStep(3)">Next</button>
        </div>
      </div>
    </div>

    <!-- STEP 3: Requirements -->
    <div class="step" id="step3">
      <div class="step-box">
        <h2 class="section-title">Event Requirements</h2>
        <div class="form-group"><label>Rules/Regulations?</label><textarea id="rules"></textarea></div>
        <div style="display:flex; gap:1rem; flex-wrap:wrap; margin-top:1rem;">
          <button class="btn btn-outline" onclick="goToStep(2)">Back</button>
          <button class="btn login-submit" onclick="goToStep(4)">Next</button>
        </div>
      </div>
    </div>

    <!-- STEP 4: Survey -->
    <div class="step" id="step4">
      <div class="step-box">
        <h2 class="section-title">Why are you creating this event?</h2>
        <div class="form-group"><label>Purpose</label>
          <select id="purpose">
            <option>Community Engagement</option>
            <option>Education / Training</option>
            <option>Lead Generation</option>
            <option>Business Promotion</option>
          </select>
        </div>
        <div class="form-group"><label>Additional Info</label><textarea id="extraInfo"></textarea></div>
        <div style="display:flex; gap:1rem; flex-wrap:wrap; margin-top:1rem;">
          <button class="btn btn-outline" onclick="goToStep(3)">Back</button>
          <button class="btn login-submit" onclick="goToStep(5)">Next</button>
        </div>
      </div>
    </div>

    <!-- STEP 5: Payment Policy Agreement -->
    <div class="step" id="step5">
      <div class="step-box">
        <h2 class="section-title">Payment Agreement</h2>
        <div class="policy-agreement">
          <p>If this is a paid event, you must agree to our policy before publishing.</p>
          <label><input type="checkbox" id="acceptPolicy" /> I accept the payment policy terms</label>
        </div>
        <div style="display:flex; gap:1rem; flex-wrap:wrap;">
          <button class="btn login-submit" onclick="submitForm()">Create Event</button>
          <button class="btn btn-outline" onclick="goToStep(4)">Back</button>
        </div>
      </div>
    </div>

  </div>

  <script>
    let currentStep = 1;
    let selectedTier = '';

    function goToStep(step) {
      document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
      document.getElementById('step' + step).classList.add('active');
      currentStep = step;
    }

    function setTier(tier) {
      selectedTier = tier;
      goToStep(2);
    }

    function requireHost(tier) {
      alert("This tier requires a Host login. Redirecting...");
      window.location.href = "eologin.html";
    }

    async function submitForm() {
      const isPaid = document.querySelector("input[name='mode'][value='paid']").checked;
      const accepted = document.getElementById("acceptPolicy").checked;
      if (isPaid && !accepted) {
        alert("Please accept the payment policy to proceed.");
        return;
      }

      const eventData = {
        title: document.getElementById("title").value,
        description: document.getElementById("description").value,
        type: document.getElementById("type").value,
        date: document.getElementById("date").value,
        time: document.getElementById("time").value,
        venue: document.getElementById("venueOrUrl").value,
        location: document.getElementById("location").value,
        duration: document.getElementById("duration").value,
        maxParticipants: document.getElementById("maxParticipants").value,
        mode: document.querySelector("input[name='mode']:checked").value,
        ticketPrice: document.getElementById("ticketPrice").value || 0,
        tier: selectedTier,
        rules: document.getElementById("rules").value,
        purpose: document.getElementById("purpose").value,
        extraInfo: document.getElementById("extraInfo").value,
      };

      try {
        const res = await fetch("http://localhost:5000/api/events", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${localStorage.getItem("token")}`
          },
          body: JSON.stringify(eventData)
        });

        const data = await res.json();
        if (res.ok) {
          alert("üéâ Event Created Successfully!");
          window.location.href = "dashboard.html";
        } else {
          alert("‚ùå Error: " + data.message);
        }
      } catch (err) {
        console.error(err);
        alert("Something went wrong. Check console.");
      }
    }
  </script>
</body>
</html>
